<%- include('include/_header')%>

<%- include('include/_sideBar')%>



 

            <!-- PAGE INNER
            ================================================== -->
            <div class="page-inner">

                <!-- PAGE MAIN WRAPPER
                ================================================== -->
                <div id="main-wrapper">
                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">General</h4>
                                </div>
                                <div class="card-body">

                                    <%if(order.paymentStatus=='return'){%>

                                        <!-- <form action="/admin/return" class="needs-validation" novalidate> -->
                                            <div class="row">
                                                <div class="col-md-12 mb-2">
                                                    <div class="form-group">
                                                        <label for="validationCustom01">Status</label>
                                                        <select name="retstat" class="form-select form-control" id="validationCustom01" aria-label="Default select example">
                                                            
                                                            <option value="refund-approved">Approve</option>
                                                            <option value="return-denied">Reject</option>
                                                        </select>
                                                        <button onclick="change_status('<%=order._id%>')" class="btn btn-success mt-2">submit</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-12 mb-2">
                                                    <div class="form-group">
                                                        <label>Reson</label>
                                                        <div>
                                                            <input type="text" readonly class="form-control date-picker">
                                                        </div>
                                                    </div>
                                                </div>
                                                 
                                            </div>
                                        <!-- </form> -->

                                        <%}else{%>
                                            <%if(order.paymentStatus=='cancelled'){%>
                                                <label style="color: red;" for="validationCustom01">Item cancelled!</label>
                                                <div class="col-md-12 mb-2">
                                                    <div class="form-group">
                                                        <label>Reson</label>
                                                        <div>
                                                            <input type="text" readonly class="form-control date-picker">
                                                        </div>
                                                    </div>
                                                </div>
                                                <%}else{%>
                                                    <%if(order.paymentStatus=='placed'){%>
                                                            <div class="row">
                                                                <div class="col-md-12 mb-2">
                                                                    <div class="form-group">
                                                                        <label for="validationCustom01">Status</label>
                                                                        <select class="form-select form-control" id="validationCustom01" aria-label="Default select example">
                                                                            <option value="shipped">shipped</option>
                                                                            <option value="delivered">delivered</option>
                                                                            <option value="cancelled">cancelled</option>
                                                                        </select> 
                                                                        <button onclick="change_status('<%=order._id%>')" class="btn btn-success mt-2">submit</button>

                                                                    </div>
                                                                </div>
                                                                
                                                                 
                                                            </div>
                                                        <%}%>
                                                    <%if(order.paymentStatus=='shipped'){%>
                                                            <div class="row">
                                                                <div class="col-md-12 mb-2">
                                                                    <div class="form-group">
                                                                        <label for="validationCustom01">Status</label>
                                                                        <select class="form-select form-control" id="validationCustom01" aria-label="Default select example">
                                                                            <option value="delivered">delivered</option>
                                                                            <option value="cancelled">cancelled</option>
                                                                        </select> 
                                                                        <button onclick="change_status('<%=order._id%>')" class="btn btn-success mt-2">submit</button>

                                                                    </div>
                                                                </div>
                                                                
                                                                 
                                                            </div>
                                                        <%}%>

                                                        <%if(order.paymentStatus=='delivered'){%>
                                                            <label style="color: rgb(26, 238, 72);" for="validationCustom01">Item Delivered!</label>
                                                            <div class="col-md-12 mb-2">
                                                                <div class="form-group">
                                                                    <label>Review</label>
                                                                    <div>
                                                                        <input type="text" readonly class="form-control date-picker">
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <%}%>
                                                            <%if(order.paymentStatus=='refund-approved' ||order.paymentStatus=='return-denied' ){%>
                                                                <label style="color: rgb(26, 238, 72);" for="validationCustom01"><%=order.paymentStatus%> </label>
                                                                <div class="col-md-12 mb-2">
                                                                     
                                                                 </div>
                                                                <%}%>
                                                    
                                                    <%}%>
                                            
                                            <%}%>
                                    

                                </div>
                            </div>
                        </div>
                        <div class="col-xl-8 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Address</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-auto me-xl-5 pe-xl-5 mb-4 mb-xl-0">
                                            <h6 class="text-uppercase fw-bold mb-3"><%=order.shippingAddress%></h6>
                                            <!-- <ul class="list-unstyled ps-0">
                                                <li>Street Name Example</li>
                                                <li>2233</li>
                                                <li>Detroit</li>
                                                <li>Michigan</li>
                                                <li>56218</li>
                                                <li>UK</li>
                                            </ul>
                                            <strong class="d-block">Email address:</strong>
                                            <a href="#">name@domain.com</a>
                                            <strong class="d-block mt-3">Phone:</strong>
                                            <a href="#">1234-5678</a> -->
                                        </div>
                                       
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-lg-12 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Product</h4>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table mb-0 order-details-table">
                                            <thead class="bg-light">
                                                <tr>
                                                    <th  class="ps-4 id">orderID</th>
                                                    <th class="ps-4 id">image</th>
                                                    <th class="name">Name</th>
                                                    <th class="text-end cost">Cost</th>
                                                    <th class="text-end qty">Qty</th>
                                                    <th class="text-end total">Total</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <%order.items.forEach(item=>{%>
                                                    <tr>
                                                        <td class="ps-4"><a href="#"><strong><%=order.orderId%></strong></a></td>
                                                        <td class="text-end"><img src="/public/uploads/<%=item.item.image%>" alt=""></td>
                                                        <td><a href="#"><%=item.item.name%></a></td>
                                                        <td class="text-end">₹ <%=item.item.price%></td>
                                                        <td class="text-end"><%=item.quantity%></td>
                                                        <td class="text-end">₹<%=item.sub_total%></td>
                                                    </tr>
                                                     <%})%>
                                                 
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row justify-content-end flex-column flex-lg-row mt-5">
                                        
                                        <div class="col-auto me-5">
                                            <h6 class="fw-bold mb-2">Shipping</h6>
                                            <span class="d-flex align-items-center">
                                                Flat Rate
                                                <i class="fas fa-chevron-right f-s-11 text-primary px-3"></i>
                                                <b>₹ Free</b>
                                            </span>
                                        </div>
                                        <div class="col-auto">
                                            <h6 class="fw-bold mb-2">Order Total</h6>
                                            <span class="d-flex align-items-center justify-content-lg-end">
                                                <strong>₹<%=order.totalAmount%></strong>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Shipping Information</h4>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless mb-0">
                                        <tbody>
                                            <tr>
                                                <th colspan="2">
                                                    <p class="m-0">Arnold Jackson</p>
                                                </th>
                                            </tr>
                                            <tr>
                                                <th scope="row">Address:</th>
                                                <td>3389 Eglinton Avenue, Windermere, London, SK 8GH.</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Phone :</th>
                                                <td>(123) 456-7890</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Mobile :</th>
                                                <td>(+01) 12345 67890</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Billing Information</h4>
                                </div>
                                <div class="card-body">
                                    <table class="table table-borderless table-sm mb-0">
                                        <tbody>
                                            <tr>
                                                <th scope="row">Payment Type:</th>
                                                <td>Credit Card</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Provider :</th>
                                                <td>Visa ending in 2851</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Valid Date :</th>
                                                <td>02/2021</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">CVV :</th>
                                                <td>xxx</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-xl-4 grid-margin">
                            <div class="card card-white h-100">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Delivery Info</h4>
                                </div>
                                <div class="card-body">
                                    <div class="text-center">
                                        <div class="my-2">
                                            <i class="fas fa-truck-moving h1 text-muted"></i>
                                        </div>
                                        <h5><b>UPS Delivery</b></h5>
                                        <div class="mt-2 pt-1">
                                            <p class="mb-1"><span>Order ID :</span> xxxx048</p>
                                            <p class="mb-0"><span>Payment Mode :</span> COD</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end row -->

                </div>

                
            </div>

            
            

    </div>

    <script>
        function change_status(ordId,qty){
            
            const status=document.querySelector('#validationCustom01')
            fetch('/admin/status',{
            method:'PUT',
            headers:{
                "content-type":"application/json"
            },
            body:JSON.stringify({
                ordId:ordId,
                status:status.value,
                qty:qty
            })
            }).then(res=>{
            res.json().then(data=>{
                alert(data.message)
                window.location.reload();
                // window.location.href = '/admin/order';
            })
            }).catch(err=>{
            console.log(err.message);
        })
        }
    </script>


<%- include('include/_footer')%>