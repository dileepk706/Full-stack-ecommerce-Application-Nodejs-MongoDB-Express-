<%- include('include/_header')%>

<%- include('include/_sideBar')%>
<style>
    div.previewImages > img {
      width: 30%;
    }
  </style>

 <!-- PAGE INNER
            ================================================== -->
            <div class="page-inner">

                <!-- PAGE MAIN WRAPPER
                ================================================== -->
                <div id="main-wrapper">
                    <!-- row -->
                    <div class="row g-xl-3">
                        <div class="col-xl-8 grid-margin">
                            <div class="card card-white mb-3">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Product information</h4>
                                    <h5 class="card-title mt-3 mb-2" style="color: red;" id="error"> </h5>

                                </div>
                                <div class="card-body">

                                    <!-- <form method="POST" enctype="multipart/form-data" action="/admin/product/add_product"> -->

                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <label for="validationCustom01">Name</label>
                                                <input name="name" type="text" class="form-control" id="name" placeholder=""   >
                                               
                                            </div>
                                            <div class="col-md-12 mb-3">
                                                <label for="validationCustom01">Discription</label>
                                                 <textarea class="form-control" id="description" name="description"  ></textarea>
 
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="validationCustom02">Price</label>
                                                <input type="number" class="form-control" id="validationCustom02" name="price" placeholder=""   >
                                                 
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label for="validationCustom03">QTY</label>
                                                <input type="number" name="quantity" class="form-control" id="quantity"  >
                                                
                                            </div>
                                             
                                        </div>

                                </div>
                            </div>
                            <div class="card card-white mb-3">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Image / only jpg or jpeg or png format</h4>
                                    <p>image will be cropped at server (612*612 pixel)</p>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div>
                                                <input type="file" class="form-control-file" id="image" name="image" multiple required>
                                                <!-- <input class="form-control form-control-lg" id="formFileLg" type="file"> -->
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="row">
                                <div class="col-sm-12">
                                  <div class="previewImages"></div>
                                </div>
                              </div>


                            <div class="card card-white">
                                <div class="card-heading clearfix">
                                    <h4 class="card-title">Select Category and Brand</h4>
                                </div>
                              

                                <div class="card-body">
                                    
                                    <label for="validationCustom06">Categories</label>
                                    <select name="sname" class="form-select form-control" id="sname" aria-label="Default select example">
                                      
                                        <% categories.forEach(category => { %>
                                            <% category.subcategories.forEach(subcategry => { %>
                                                <option value="<%= subcategry.name %>"><%= subcategry.name %></option> 
                                                <% }) %>
                                            <% }) %>
                                    </select>
                               

                            </div>

                            <div class="card-body mt-3">

                                    
                                <label for="validationCustom06">Brand</label>
                                
                                <select name="brand_name" class="form-select form-control" id="brand_name" aria-label="Default select example">
                                     
                                    <% brand.forEach(brand_name => { %>
                                        <option value="<%= brand_name.name %>"><%= brand_name.name %></option>
                                    <% }) %>
                                </select>
                           

                        </div>
                <button onclick="addProduct()" class="btn btn-primary mt-5">Add Product</button>

                    </div>

                </div>

                    <!-- </form> -->

                         
                    </div>
                    <!-- end row -->
                </div>
 
            </div>

<!-- <div class="main">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <h1 style="margin-top: 10px;margin-left: 20px;">Add Product</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8 ml-5">
                <form method="POST" enctype="multipart/form-data" action="/admin/product/add_product">
                    <div class="form-group">
                        <label for="name">Product Name:</label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Enter product name" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter product description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="price">Price:</label>
                        <input type="number" class="form-control" id="price" name="price" placeholder="Enter product price" required>
                    </div>
                    <div class="form-group">
                        <label for="price">Quantity:</label>
                        <input type="number" class="form-control" id="price" name="price,quantity" placeholder="Enter product price" required>
                    </div>
                   
                   
                    <select class="form-control" id="category" name="pname" required>
                        <option value="" selected disabled>Select category</option>

                        <% categories.forEach(category => { %>
                            <option value="<%= category.name %>"><%= category.name %></option>
                            <% }) %>
                            

                    </select>
                    <br>
                    <select class="form-control" id="category" name="sname" required>
                        <option value="" selected disabled>Select Sub_category</option>
                        
                            <option value="Mobiles">Mobiles</option>
                            <% categories.forEach(category => { %>
                                <% category.subcategories.forEach(subcategry => { %>
                                    <option value="<%= subcategry.name %>"><%= subcategry.name %></option> 
                                    <% }) %>
                                <% }) %>
                    </select>
                    <br>
                    
                    
                    
                    <select class="form-control" id="category" name="brand_name" required>
                        <option value="" selected disabled>Select Brand Nmae</option>
                        <% brand.forEach(brand_name => { %>
                            <option value="<%= brand_name.name %>"><%= brand_name.name %></option>
                            <% }) %>
                    </select>
                    <br>
                    <div class="form-group">
                        <label for="image">Images:</label>
                        <input type="file" class="form-control-file" id="image" name="image" multiple required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </form>
                <br>
<br>
<br>
            </div>
        </div>
    </div>
</div> -->

<script>
   $(document).ready(function() {
        let imgPreview = function(input, imgaePlace) {
          if (input.files) {
            let allFiles = input.files.length;
            for (i = 0; i < allFiles; i++) {
              let reader = new FileReader();
              reader.onload = function(event) {
                $($.parseHTML("<img>"))
                  .attr("src", event.target.result)
                  .appendTo(imgaePlace);
              };
              reader.readAsDataURL(input.files[i]);
            }
          }
        };
        $("#image").on("change", function() {
          imgPreview(this, "div.previewImages");
        });
      });


 
 

 



    const addProduct = async () => {
      const name = document.getElementById("name").value;
      const description = document.getElementById("description").value;
      const price = parseInt(document.getElementById("validationCustom02").value);
      const quantity = parseInt(document.getElementById("quantity").value);
      const sname = document.getElementById("sname").value;
      const brand_name = document.getElementById("brand_name").value;
      const image = document.getElementById("image").files;
    
      const formData = new FormData();
      formData.append("name", name);
      formData.append("description", description);
      formData.append("price", price);
      formData.append("quantity", quantity);
      formData.append("sname", sname);
      formData.append("brand_name", brand_name);
    
      for (let i = 0; i < image.length; i++) {
        formData.append("image", image[i]);
      }
    
      try {
        const response = await fetch("/admin/product/add_product", {
          method: "POST",
          body: formData,
        });
        const data = await response.json();
    
        if (response.ok) {
            swal.fire({
                title: 'Success',
                text: data.message,
                icon: 'success',
                confirmButtonText: 'OK'
                }).then(result=>{
                if(result.isConfirmed){
                 window.location.reload()
    
                }
                });
    
        } else {
            console.log(data.error);
            document.querySelector('#error').innerHTML=data.message
        }
      } catch (error) {
        console.log(error);
      }
    };
    
    </script>
<%- include('include/_footer')%>